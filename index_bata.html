<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ­å¹Œå¸‚å—åŒº</title>
    <link rel="stylesheet" href="assets/style.css">
    <script src="assets/common.js"></script>
    <!-- Intro.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intro.js/7.0.1/introjs.min.css" />

    <!-- Intro.js JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intro.js/7.0.1/intro.min.js"></script>
</head>
<style>
    /* Heroã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ */
    .hero {
        position: relative;
        margin: 20px auto 10px auto;
        /* ä¸Šä¸‹60pxã€å·¦å³è‡ªå‹•ã§ä¸­å¤®å¯„ã› */
        width: 90%;
        /* æ¨ªå¹…ã¯ç”»é¢ã®90% */
        max-width: 500px;
        /* æœ€å¤§å¹…ã‚’500pxã«åˆ¶é™ */
        aspect-ratio: 2/1;
        /* é«˜ã•ã¯å¹…ã«å¯¾ã—ã¦2:1 */
        border-radius: 20px;
        overflow: hidden;
    }

    .hero-slide {
        position: absolute;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: opacity 1s ease-in-out;
        z-index: 1;
    }

    .hero-slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 20px;
    }

    .hero-slide.active {
        opacity: 1;
        z-index: 2;
    }

    /* --popup--*/
    #popup {
        position: fixed;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        z-index: 2000;
    }

    .popup-content {
        background: #fff;
        margin: auto 10px;
        padding: 10px 20px;
        border-radius: 15px;
        width: 95%;
        flex-direction: column;
        text-align: center;
        position: relative;
    }

    .popup-content h3 {
        font-size: var(--font-h3);
    }

    .popup-content .popup-question {
        display: flex;
        text-align: left;
        align-items: left;
        margin-bottom: 15px;
    }

    #popupSubmit {
        padding: 15px 40px;
        cursor: pointer;
        background: #247627;
        font-weight: bold;
        font-size: var(--font-button);
        color: #f5f8fb;
        border: #247627;
        border-radius: 50px;
    }

    .popup-line {
        display: flex;
        flex-wrap: wrap;
        /* å­è¦ç´ ã‚’æŠ˜ã‚Šè¿”ã™ */
        flex-direction: column;
        gap: 5px;
    }

    .popup-question {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }


    /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒœãƒƒã‚¯ã‚¹ */
    #contents {
        padding: 10px;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .content-box {
        display: flex;
        padding: 10px 20px 10px 10px;
        border-radius: 20px;
        align-items: center;
        background-color: var(--color-primary);
        text-decoration: none;
    }

    .content-box .arrow {
        display: inline-block;
        margin-left: auto;
        width: 10px;
        height: 10px;
        border-bottom: 5px solid #fffdf9;
        border-right: 5px solid #fffdf9;
        transform: rotate(-45deg);
    }

    .content-box .icon img {
        width: 3em;
        padding: 0.5em;
        object-fit: contain;
    }

    .content-box .text {
        padding: 0px 0.5em;
        color: var(--color-bg);
    }

    .content-box h2,
    .content-box h4 {
        margin: 0px;
    }

    .content-box h2 {
        margin-bottom: 0.2em;
    }

    /* form */
    select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        padding: 10px 40px 10px 12px;
        font-size: var(--font-body);
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: #fff;
        background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg width='10' height='6' viewBox='0 0 10 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0l5 6 5-6H0z' fill='%23333'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 10px 6px;
        cursor: pointer;
        transition: border 0.3s, box-shadow 0.3s;
    }

    .form-section {
        display: flex;
        flex-direction: column;
        gap: 5px;
        margin: 10px;
    }

    #region,
    #audience {
        margin: 0px 30px;
    }



    /* ãƒˆã‚°ãƒ«ãƒªã‚¹ãƒˆ */
    .personalize {
        margin: 10px;
        background-color: var(--color-secondary);
        padding: 10px;
        border-radius: 14px;
        margin-bottom: 30px;
    }

    .toggle-list {
        margin-bottom: 20px;
        border-radius: 12px;
        overflow: hidden;
        text-align: center;
        background: var(--color-primary);
    }

    .toggle-header {
        display: flex;
        padding: 15px 40px;
        cursor: pointer;
        background: var(--color-primary);
        font-weight: bold;
        color: var(--color-bg);
        font-size: var(--font-h3);
    }

    .toggle-header span {
        font-size: var(--font-h1);
        margin-left: auto;
        /* å·¦å´ã®ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰è‡ªå‹•ã§é›¢ã™ */
    }

    .toggle-content {
        display: none;
        padding: 0.1em 0.4em;
        background: #fff;
    }

    .toggle-list.active .toggle-content {
        display: block;
    }

    .recommended-container {
        display: flex;
        justify-content: center;
        gap: 4px;
        align-items: stretch;
    }

    .recommended-card {
        background: var(--color-bg);
        justify-content: center;
        padding: 15px;
        border-radius: 15px;
        margin: 7px;
        text-align: center;
        flex: 0 0 calc(50% - 14px);
        box-sizing: border-box;
    }

    .recommended-card h4 {
        font-size: var(--font-h4);
        color: #555555;
        margin: 0px 0px 7px 0px;
    }

    .recommended-card p {
        font-size: var(--font-p);
        margin: 0px 0px 8px 0px;
        color: #333;
    }

    .recommended-card a {
        display: inline-block;
        margin-top: 8px;
        padding: 8px 16px;
        background: #0073e6;
        color: #fff;
        border-radius: 8px;
        text-decoration: none;
        font-size: var(--font-p);
    }


    /* ãƒœã‚¿ãƒ³ */
    #start-tour {
        padding: 15px 40px;
        cursor: pointer;
        background: var(--color-primary);
        font-weight: bold;
        font-size: var(--font-button);
        color: var(--color-bg);
        border: var(--color-primary);
        border-radius: 50px;
    }

    .end {
        text-align: center;
    }

    .popup-card {
        display: none;
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 1rem;
        animation: fadeIn 0.3s ease;
    }

    .popup-card.active {
        display: flex;
    }

    .popup-buttons {
        display: flex;
        gap: 1rem;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    .popup_underbutton{
        display: flex;
    }
</style>

<body>
    <!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€²æ—ãƒãƒ¼ -->
    <div id="scrollProgress"></div>

    <!-- ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼šã‚«ãƒ¼ãƒ‰æ–¹å¼ -->
    <div id="popup" style="display:none;">
        <div class="popup-content" id="popupCardContainer">
            <!-- STEP 1 -->
            <div class="popup-card active" data-step="1">
                <h3>ã“ã®ã‚µã‚¤ãƒˆã‚’è¨ªã‚Œã‚‹ã®ã¯<br>åˆã‚ã¦ã§ã™ã‹ï¼Ÿ</h3>
                <div class="popup-buttons">
                    <button class="popup-next" data-answer="yes">ã¯ã„</button>
                    <button class="popup-skip" data-answer="no">ã„ã„ãˆ</button>
                </div>
            </div>

            <!-- STEP 2 -->
            <div class="popup-card" data-step="2">
                <h3>ã‚ãªãŸã¯å—åŒºå¸‚æ°‘ã§ã™ã‹ï¼Ÿ</h3>
                <div class="popup-buttons">
                    <button class="popup-next" data-answer="yes">ã¯ã„</button>
                    <button class="popup-next" data-answer="no">ã„ã„ãˆ</button>
                </div>
                <button class="popup-back">æˆ»ã‚‹</button>
            </div>

            <!-- STEP 3ï¼ˆå—åŒºå‘ã‘ç«‹å ´ï¼‰ -->
            <div class="popup-card" data-step="3">
                <h3>ã‚ãªãŸã®ç«‹å ´ã‚’æ•™ãˆã¦ãã ã•ã„</h3>
                <select id="popupAudienceYes">
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="ä¸€äººæš®ã‚‰ã—">ä¸€äººæš®ã‚‰ã—</option>
                    <option value="äº‹æ¥­è€…">äº‹æ¥­è€…</option>
                    <option value="å­è‚²ã¦">å­è‚²ã¦</option>
                    <option value="ã‚·ãƒ‹ã‚¢">ã‚·ãƒ‹ã‚¢</option>
                    <option value="ãã®ä»–">ãã®ä»–</option>
                </select>
                <div class="popup-underbuttons">
                <button class="popup-back">æˆ»ã‚‹</button>
                <button class="popup-next">æ¬¡ã¸</button>
                </div>
            </div>

            <!-- STEP 4ï¼ˆå—åŒºä»¥å¤–å‘ã‘ç«‹å ´ï¼‰ -->
            <div class="popup-card" data-step="4">
                <h3>ã‚ãªãŸã®ç«‹å ´ã‚’æ•™ãˆã¦ãã ã•ã„</h3>
                <select id="popupAudienceNo">
                    <option value="è¨­å®šãªã—">è¨­å®šãªã—</option>
                    <option value="èª¿ã¹å­¦ç¿’">èª¿ã¹å­¦ç¿’</option>
                    <option value="å¼•ã£è¶Šã—æ¤œè¨">å¼•ã£è¶Šã—ã‚’æ¤œè¨</option>
                </select>
                <div class="popup-underbuttons">
                <button class="popup-back">æˆ»ã‚‹</button>
                <button class="popup-next">æ¬¡ã¸</button>
                </div>
            </div>

            <!-- STEP 5ï¼ˆå—åŒºæ°‘ã®ã¿åœ°åŸŸé¸æŠï¼‰ -->
            <div class="popup-card" data-step="5">
                <h3>ãŠä½ã¾ã„ã®åœ°åŸŸã‚’æ•™ãˆã¦ãã ã•ã„</h3>
                <select id="popupRegion">
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="area_1">çœŸé§’å†…æŸä¸˜/æ±ç”º</option>
                    <option value="area_2">çŸ³å±±æ±/å¸¸ç›¤/æ»é‡/èŠ¸è¡“ã®æ£®</option>
                    <option value="area_3">è—¤é‡/ç™½å·/ç°¾èˆ/ç ¥å±±/è±Šæ»</option>
                    <option value="area_4">çœŸé§’å†…æœ¬ç”º/å®¹ç”º/æ›™ç”º/ç·‘ç”º</option>
                    <option value="area_5">æ¾„å·</option>
                    <option value="area_6">å—æ²¢</option>
                    <option value="area_7">çœŸé§’å†…</option>
                </select>
                <div class="popup-underbuttons">
                <button class="popup-back">æˆ»ã‚‹</button>
                <button class="popup-next">æ¬¡ã¸</button>
                </div>
            </div>

            <!-- STEP 6ï¼ˆã‚¬ã‚¤ãƒ‰é–‹å§‹ï¼‰ -->
            <div class="popup-card" data-step="6">
                <h3>è¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸï¼<br>ã‚¬ã‚¤ãƒ‰ã‚’é–‹å§‹ã—ã¾ã™</h3>
                <button id="popupSubmit">ã‚µã‚¤ãƒˆã‚’è¦‹ã‚‹</button>
                <button class="popup-back">æˆ»ã‚‹</button>
            </div>
        </div>
    </div>


    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼èª­ã¿è¾¼ã¿ -->
    <div id="header"></div>

    <!-- ä½™ç™½ -->
    <div style="height: 60px;  background-color: #ffffff;">
    </div>

    <main>

        <!-- Heroã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ -->
        <section class="hero">
            <a href="https://www.city.sapporo.jp/minami/news/202510/20251018.html" class="hero-slide">
                <img src="/data/photo_1.jpg" alt="ç”»åƒ1">
            </a>
            <a href="https://www.city.sapporo.jp/minami/news/202510/20251028.html" class="hero-slide">
                <img src="/data/photo_2.JPG" alt="ç”»åƒ2">
            </a>
            <a href="https://www.city.sapporo.jp/minami/news/202510/20251020.html" class="hero-slide">
                <img src="/data/photo_3.jpg" alt="ç”»åƒ3">
            </a>
        </section>

        <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒœãƒƒã‚¯ã‚¹ -->
        <section id="contents">
            <a href="search.html" class="content-box">
                <div class="icon">
                    <img src="data/home_1.png" alt="æƒ…å ±ã‚’æ¢ã™ã‚¢ã‚¤ã‚³ãƒ³">
                </div>
                <div class="text">
                    <h2>æƒ…å ±ã‚’æ¢ã™</h2>
                    <h4>æ‰‹ç¶šãã‚’çŸ¥ã‚ŠãŸã„</h4>
                </div>
                <div class="arrow"></div>
            </a>
            <a href="news.html" class="content-box">
                <div class="icon">
                    <img src="data/home_2.png" alt="æƒ…å ±ã‚’æ¢ã™ã‚¢ã‚¤ã‚³ãƒ³">
                </div>
                <div class="text">
                    <h2>ãŠçŸ¥ã‚‰ã›ã‚’è¦‹ã‚‹</h2>
                    <h4>ãƒ‹ãƒ¥ãƒ¼ã‚¹/ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¦‹ã‚‹</h4>
                </div>
                <div class="arrow"></div>
            </a>
        </section>
        <section class="personalize">
            <div class="toggle-list">
                <div id="tog-header" class="toggle-header">ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’ã™ã‚‹<span>+</span></div>
                <div class="toggle-content">
                    <div class="form-section">
                        <label for="region">ãŠä½ã¾ã„ã®åœ°åŸŸ</label>
                        <select id="region">
                            <option value="ãªã—">ãªã—</option>
                            <option value="area_1">çœŸé§’å†…æŸä¸˜/æ±ç”º/å¹¸ç”º/æ³‰ç”º/å—ç”º</option>
                            <option value="area_2">çŸ³å±±æ±/å¸¸ç›¤/æ»é‡/èŠ¸è¡“ã®æ£®</option>
                            <option value="area_3">è—¤é‡/ç™½å·/ç°¾èˆ/ç ¥å±±/è±Šæ»/ç¡¬çŸ³å±±/å°é‡‘æ¹¯/å®šå±±æ¸“æ¸©æ³‰è¥¿/å®šå±±æ¸“æ¸©æ³‰æ±/å®šå±±æ¸“</option>
                            <option value="area_4">çœŸé§’å†…æœ¬ç”º/å®¹ç”º/æ›™ç”º/ç·‘ç”º</option>
                            <option value="area_5">æ¾„å·</option>
                            <option value="area_6">å—æ²¢</option>
                            <option value="area_7">çœŸé§’å†…</option>
                        </select>
                    </div>

                    <div class="form-section">
                        <label for="audience">å¯¾è±¡è€…</label>
                        <select id="audience">
                            <option value="ä¸€èˆ¬">å—åŒºåŒºæ°‘</option>
                            <option value="èª¿ã¹å­¦ç¿’">èª¿ã¹å­¦ç¿’</option>
                            <option value="å¼•ã£è¶Šã—æ¤œè¨">å¼•ã£è¶Šã—ã‚’æ¤œè¨</option>
                            <option value="ä¸€äººæš®ã‚‰ã—">ä¸€äººæš®ã‚‰ã—</option>
                            <option value="äº‹æ¥­è€…">äº‹æ¥­è€…</option>
                            <option value="å­è‚²ã¦">å­è‚²ã¦</option>
                            <option value="ã‚·ãƒ‹ã‚¢">ã‚·ãƒ‹ã‚¢</option>
                        </select>
                    </div>

                    <div class="form-section font-size-toggle">
                        <label>æ–‡å­—ã‚µã‚¤ã‚º</label>
                        <div>
                            <label><input type="radio" name="font-size" value="small"> å°</label>
                            <label><input type="radio" name="font-size" value="medium"> ä¸­</label>
                            <label><input type="radio" name="font-size" value="large" checked> å¤§</label>
                        </div>
                    </div>
                </div>
                <!-- toggleå¤– -->
            </div>
            <div id="dynamicContent"></div>
        </section>

        <section class="end">
            <button id="start-tour" data-step="3">
                ã‚¬ã‚¤ãƒ‰é–‹å§‹
            </button>
        </section>




    </main>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼èª­ã¿è¾¼ã¿ -->
    <div id="footer"></div>

    <!-- JS èª­ã¿è¾¼ã¿ -->

    <script>
        // Heroã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼
        const slides = document.querySelectorAll('.hero-slide');
        let currentSlide = 0;
        const slideInterval = 7000; // 4ç§’ã”ã¨ã«åˆ‡ã‚Šæ›¿ãˆ

        function showSlide(index) {
            slides.forEach((slide, i) => {
                slide.classList.toggle('active', i === index);
            });
        }

        // åˆæœŸè¡¨ç¤º
        showSlide(currentSlide);

        // è‡ªå‹•åˆ‡æ›¿
        setInterval(() => {
            currentSlide = (currentSlide + 1) % slides.length;
            showSlide(currentSlide);
        }, slideInterval);
        // -------------------------------
        // è¦ç´ å–å¾—
        // -------------------------------
        const regionSelect = document.getElementById('region');
        const audienceSelect = document.getElementById('audience');
        const dynamicContent = document.getElementById('dynamicContent');
        const startTourBtn = document.getElementById('start-tour');

        // -------------------------------
        // è¨˜äº‹ãƒ‡ãƒ¼ã‚¿
        // -------------------------------
        const recommendedArticles = {
            ä¸€èˆ¬: [
                { title: "ç°¡å˜ã«è¨¼æ˜æ›¸ç™ºè¡Œã‚’ã™ã‚‹ã‚³ãƒ„", url: "#" },
                { title: "å›½æ°‘å¥åº·ä¿é™ºæ–™ã®å¤œé–“ç´ä»˜ç›¸è«‡ã®ãŠçŸ¥ã‚‰ã›", url: "https://www.city.sapporo.jp/minami/hoken/yakannofusodan.html" },
                { title: "å—åŒºå½¹æ‰€é£Ÿå ‚å–¶æ¥­å†é–‹ã®ãŠçŸ¥ã‚‰ã›", url: "https://www.city.sapporo.jp/minami/oshirase/20251020shokudo.html" }
            ],
            ä¸€äººæš®ã‚‰ã—: [
                { title: "æ¥åºã›ãšã«ã§ãã‚‹æ‰‹ç¶šã", url: "https://www.city.sapporo.jp/minami/annai/jyuminhyoraityonashi.html" },
                { title: "ä½å±…ç¢ºä¿çµ¦ä»˜é‡‘ã«ã¤ã„ã¦", url: "https://step-sapporo.jp/housingbenefit/?utm_source=chatgpt.com" },
                { title: "ã‚¢ãƒ«ãƒã‚¤ãƒˆæƒ…å ±ã¾ã¨ã‚", url: "#" }
            ],
            äº‹æ¥­è€…: [
                { title: "ä¼æ¥­DXæ¨é€²ã«å‘ã‘ãŸæ”¯æ´", url: "https://www.city.sapporo.jp/keizai/top/topics/it/kigyoudx.html?utm_source=chatgpt.com" },
                { title: "ä¸­å°ä¼æ¥­ã¸ã®èè³‡ãƒ»æ”¯æ´", url: "https://www.city.sapporo.jp/keizai/chusho/index.html" },
                { title: "äº‹æ¥­æ‰€ã‹ã‚‰å‡ºã‚‹ã”ã¿", url: "https://www.city.sapporo.jp/seiso/jigyousyo/jigyousyo.html" }
            ],
            èª¿ã¹å­¦ç¿’: [
                { title: "å‹•ç”»ã§çŸ¥ã‚‹å—åŒº", url: "https://www.city.sapporo.jp/keizai/top/topics/it/kigyoudx.html?utm_source=chatgpt.com" },
                { title: "åºƒå ±ã•ã£ã½ã‚", url: "https://www.city.sapporo.jp/keizai/chusho/index.html" },
                { title: "å—åŒºã®åœ°åŸŸç´¹ä»‹", url: "https://www.city.sapporo.jp/seiso/jigyousyo/jigyousyo.html" }
            ],
            å¼•ã£è¶Šã—æ¤œè¨: [
                { title: "å¼•ã£è¶Šã—ä½“é¨“è«‡", url: "https://www.city.sapporo.jp/keizai/top/topics/it/kigyoudx.html?utm_source=chatgpt.com" },
                { title: "åºƒå ±ã•ã£ã½ã‚", url: "https://www.city.sapporo.jp/keizai/chusho/index.html" },
                { title: "å—åŒºã®åœ°åŸŸç´¹ä»‹", url: "https://www.city.sapporo.jp/seiso/jigyousyo/jigyousyo.html" }
            ],
            ã‚·ãƒ‹ã‚¢: [
                { title: "ç´…è‘‰ã‚¦ã‚ªãƒ¼ã‚­ãƒ³ã‚°å¤§ä¼š", url: "https://www.city.sapporo.jp/minami/news/202510/20251018.html" },
                { title: "ç†Ÿå¹´è€…ãµã‚Œã‚ã„äº¤æµä¼š", url: "https://www.city.sapporo.jp/minami/news/202510/20251015-2.html" },
                { title: "å—åŒºã®èªçŸ¥ç—‡ã¸ã®å–çµ„", url: "https://www.city.sapporo.jp/minami/fukushi/nintisyoumap.html" }
            ]
        };
        // -------------------------------
        // åœ°åŸŸãƒ‡ãƒ¼ã‚¿
        // -------------------------------
        const calendarPages = {
            area_1: "https://www.city.sapporo.jp/seiso/kaisyu/08_minami/documents/07minami1_07090809.pdf",
            area_2: "https://www.city.sapporo.jp/seiso/kaisyu/08_minami/documents/07minami2_07090809.pdf",
            area_3: "https://www.city.sapporo.jp/seiso/kaisyu/08_minami/documents/07minami3_07090809.pdf",
            area_4: "https://www.city.sapporo.jp/seiso/kaisyu/08_minami/documents/07minami4_07090809.pdf",
            area_5: "calendar_area5.html",
            area_6: "calendar_area6.html",
            area_7: "calendar_area7.html"
        };
        const nearbyFacilities = {
            area_1: [
                { name: "è¿‘ãã®æ–½è¨­", url: "facility_sumikawa_library.html" },
            ],
            area_2: [
                { name: "è¿‘ãã®æ–½è¨­", url: "facility_sumikawa_library.html" },
            ],
            area_3: [
                { name: "è¿‘ãã®æ–½è¨­", url: "facility_sumikawa_library.html" },
            ],
            area_4: [
                { name: "è¿‘ãã®æ–½è¨­", url: "facility_sumikawa_library.html" },
            ],
            area_5: [
                { name: "è¿‘ãã®æ–½è¨­", url: "facility_sumikawa_library.html" },
            ],
            area_6: [
                { name: "è¿‘ãã®æ–½è¨­", url: "facility_sumikawa_library.html" },
            ],
            area_7: [
                { name: "è¿‘ãã®æ–½è¨­", url: "facility_sumikawa_library.html" },
            ],
        };
        // -------------------------------------------------------------
        // ğŸŸ¢ ã‚«ãƒ¼ãƒ‰å¼POPUPãƒ•ãƒ­ãƒ¼åˆ¶å¾¡
        // -------------------------------------------------------------
        const popup = document.getElementById('popup');
        const popupCards = document.querySelectorAll('.popup-card');
        const popupSubmit = document.getElementById('popupSubmit');
        const popupRegion = document.getElementById('popupRegion');
        const popupAudienceYes = document.getElementById('popupAudienceYes');
        const popupAudienceNo = document.getElementById('popupAudienceNo');

        let currentStep = 1;
        let userData = {
            isFirst: null,
            isResident: null,
            audience: null,
            region: null
        };

        // -------------------------------
        // å‰å›è¨ªå•ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        // -------------------------------
        const hasVisited_index = localStorage.getItem('hasVisited_index');
        const savedRegion = localStorage.getItem('selectedRegion');
        const savedAudience = localStorage.getItem('selectedAudience');

        // -------------------------------
        // åˆæœŸåŒ–å‡¦ç†ï¼ˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ï¼‰
        // -------------------------------
        window.addEventListener('load', () => {
            if (!hasVisited_index) {
                // åˆå›è¨ªå• â†’ POPUPã‚’è¡¨ç¤º
                popup.style.display = 'flex';
            } else {
                // 2å›ç›®ä»¥é™ â†’ å‰å›é¸æŠã‚’åæ˜ 
                if (savedRegion && savedAudience) {
                    regionSelect.value = savedRegion;
                    audienceSelect.value = savedAudience;
                    updateDynamicContent();
                }
            }
        });

        const hasVisited_index_bata = localStorage.getItem('hasVisited_index');
        if (!hasVisited_index) {
            popup.style.display = 'flex';
        }

        // ã‚«ãƒ¼ãƒ‰åˆ‡æ›¿é–¢æ•°
        function showStep(step) {
            popupCards.forEach(card => {
                card.classList.toggle('active', Number(card.dataset.step) === step);
            });
            currentStep = step;
        }

        // ã€Œæ¬¡ã¸ã€ã€Œã¯ã„ã€ã€Œã„ã„ãˆã€ãƒœã‚¿ãƒ³
        document.querySelectorAll('.popup-next, .popup-skip').forEach(btn => {
            btn.addEventListener('click', e => {
                const answer = e.target.dataset.answer;

                switch (currentStep) {
                    case 1:
                        if (answer === 'no') {
                            popup.style.display = 'none';
                            return;
                        }
                        userData.isFirst = true;
                        showStep(2);
                        break;

                    case 2:
                        userData.isResident = answer;
                        if (answer === 'yes') showStep(3);
                        else showStep(4);
                        break;

                    case 3:
                        if (!popupAudienceYes.value) {
                            alert("ç«‹å ´ã‚’é¸æŠã—ã¦ãã ã•ã„");
                            return;
                        }
                        userData.audience = popupAudienceYes.value;
                        showStep(5);
                        break;

                    case 4:
                        if (!popupAudienceNo.value) {
                            alert("ç«‹å ´ã‚’é¸æŠã—ã¦ãã ã•ã„");
                            return;
                        }
                        userData.audience = popupAudienceNo.value;
                        showStep(6);
                        break;

                    case 5:
                        if (!popupRegion.value) {
                            alert("åœ°åŸŸã‚’é¸æŠã—ã¦ãã ã•ã„");
                            return;
                        }
                        userData.region = popupRegion.value;
                        showStep(6);
                        break;
                }
            });
        });

        // ğŸ”™ æˆ»ã‚‹ãƒœã‚¿ãƒ³å‡¦ç†
        document.querySelectorAll('.popup-back').forEach(btn => {
            btn.addEventListener('click', () => {
                switch (currentStep) {
                    case 2:
                        showStep(1);
                        break;
                    case 3:
                        showStep(2);
                        break;
                    case 4:
                        showStep(2);
                        break;
                    case 5:
                        showStep(3);
                        break;
                    case 6:
                        if (userData.isResident === 'yes') showStep(5);
                        else showStep(4);
                        break;
                }
            });
        });

        // å®Œäº†ãƒœã‚¿ãƒ³
        popupSubmit.addEventListener('click', () => {
            if (userData.isResident === 'no') userData.region = 'ãªã—';

            localStorage.setItem('selectedRegion', userData.region);
            localStorage.setItem('selectedAudience', userData.audience);
            localStorage.setItem('hasVisited_index', 'true');

            regionSelect.value = userData.region;
            audienceSelect.value = userData.audience;

            updateDynamicContent();
            popup.style.display = 'none';
            startTour();
        });
        // -------------------------------
        // ã‚»ãƒ¬ã‚¯ãƒˆå¤‰æ›´æ™‚ï¼šä¿å­˜ï¼‹æ›´æ–°
        // -------------------------------
        regionSelect.addEventListener('change', () => {
            localStorage.setItem('selectedRegion', regionSelect.value);
            updateDynamicContent();
        });

        audienceSelect.addEventListener('change', () => {
            localStorage.setItem('selectedAudience', audienceSelect.value);
            updateDynamicContent();
        });

        // -------------------------------
        // ãƒ„ã‚¢ãƒ¼ãƒœã‚¿ãƒ³ï¼ˆ2å›ç›®ä»¥é™ã§ã‚‚å†é–‹å¯èƒ½ï¼‰
        // -------------------------------
        startTourBtn.addEventListener('click', () => {
            startTour();
        });
        // -------------------------------
        // intro.jsãƒ„ã‚¢ãƒ¼é–¢æ•°
        // -------------------------------
        function startTour() {
            introJs()
                .setOptions({
                    steps: [
                        {
                            element: '#emergency',
                            intro: 'ã“ã“ã‹ã‚‰ç·Šæ€¥æƒ…å ±ãƒ»ç·Šæ€¥æ™‚ã®å¯¾å¿œã‚’ç¢ºèªã§ãã¾ã™<br>(1/4)',
                            position: 'bottom'
                        },
                        {
                            element: '#contents',
                            intro: 'ã“ã“ã‹ã‚‰ç›®çš„åˆ¥ã§æƒ…å ±ã‚’æ¢ã™ã“ã¨ãŒã§ãã¾ã™<br>(2/4)',
                            position: 'top'
                        },
                        {
                            element: '#tog-header',
                            intro: 'ã“ã“ã§ã¯ã€ãŠã™ã™ã‚æƒ…å ±ãŒã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ï¼<br>ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦è¨­å®šç”»é¢ã‚’é–‹ã‘ã¾ã™ï¼<br>(3/4)',
                            position: 'right'
                        },
                        {
                            element: '#start-tour',
                            intro: 'ã“ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ä»Šã®ã‚¬ã‚¤ãƒ‰ã‚’è¦‹ã‚Œã¾ã™<br>(4/4)',
                            position: 'top'
                        }
                    ],
                    showProgress: true,
                    exitOnOverlayClick: false
                })
                .oncomplete(function () {
                    alert('ã‚¬ã‚¤ãƒ‰ã¯çµ‚ã‚ã‚Šã¾ã—ãŸï¼ãƒšãƒ¼ã‚¸ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼');
                })
                .start();
        }
        // -------------------------------
        // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ›´æ–°é–¢æ•°ï¼ˆè¨˜äº‹ï¼‹åœ°åŸŸï¼‰
        // -------------------------------
        function updateDynamicContent() {
            const region = regionSelect.value;
            const audience = audienceSelect.value;

            dynamicContent.innerHTML = "";

            // ã”ã¿ï¼‹æ–½è¨­ã‚«ãƒ¼ãƒ‰ç”¨ã‚³ãƒ³ãƒ†ãƒŠï¼ˆæ¨ªä¸¦ã³ï¼‰
            const mainContainer = document.createElement('div');
            mainContainer.classList.add('recommended-container');
            if (region && region !== "ãªã—") {
                const card = document.createElement('div');
                card.classList.add('recommended-card');
                card.innerHTML = `
            <h4>ã”ã¿åé›†ã«<br>ã¤ã„ã¦</h4>
            <a href="${calendarPages[region]}" target="_blank">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’è¦‹ã‚‹</a>
        `;
                mainContainer.appendChild(card);
            }

            // ã”ã¿åé›†ã‚«ãƒ¼ãƒ‰
            /*       if (region && region !== "ãªã—") {
                    const card = document.createElement('div');
                    card.classList.add('recommended-card');
                    card.innerHTML = `
                        <h4>${region}ã®ã”ã¿åé›†</h4>
                        <a href="${calendarPages[region]}" target="_blank">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’è¦‹ã‚‹</a>
                    `;
                    mainContainer.appendChild(card);
                  } */

            // æ–½è¨­ã‚«ãƒ¼ãƒ‰
            if (region && nearbyFacilities[region]) {
                nearbyFacilities[region].forEach(facility => {
                    const card = document.createElement('div');
                    card.classList.add('recommended-card');
                    card.innerHTML = `
                <h4>${facility.name}</h4>
                <a href="${facility.url}" target="_blank">è©³ç´°ã‚’è¦‹ã‚‹</a>
            `;
                    mainContainer.appendChild(card);
                });
            }

            // æ¨ªä¸¦ã³ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’è¿½åŠ 
            dynamicContent.appendChild(mainContainer);

            // ãŠã™ã™ã‚è¨˜äº‹ã‚«ãƒ¼ãƒ‰ã¯åˆ¥ã‚³ãƒ³ãƒ†ãƒŠï¼ˆç¸¦ä¸¦ã³ï¼‰
            if (audience && recommendedArticles[audience]) {
                const articleContainer = document.createElement('div');
                articleContainer.classList.add('recommended-container');
                articleContainer.style.flexDirection = 'column'; // ç¸¦ä¸¦ã³ã«å¤‰æ›´

                recommendedArticles[audience].forEach(article => {
                    const card = document.createElement('div');
                    card.classList.add('recommended-card');
                    card.innerHTML = `
                <h4>${article.title}</h4>
                <p>è¨˜äº‹ã®ç°¡å˜ãªèª¬æ˜ã‚’ã“ã“ã«å…¥ã‚Œã‚‰ã‚Œã¾ã™</p>
                <a href="${article.url}" target="_blank">è©³ã—ãè¦‹ã‚‹</a>
            `;
                    articleContainer.appendChild(card);
                });

                dynamicContent.appendChild(articleContainer);
            }
        }
        // -------------------------------
        // âœ… ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šãƒªã‚»ãƒƒãƒˆé–¢æ•°ï¼ˆé–‹ç™ºæ™‚ã®ã¿ï¼‰
        // -------------------------------
        function resetTour() {
            localStorage.clear();
            alert('åˆå›çŠ¶æ…‹ã«æˆ»ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
        }

        // -------------------------------
        // æ–‡å­—ã‚µã‚¤ã‚ºåˆ‡ã‚Šæ›¿ãˆï¼ˆCSSå¤‰æ•°å¯¾å¿œï¼‰
        // -------------------------------
        const fontSizeRadios = document.querySelectorAll('input[name="font-size"]');

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¿å­˜å€¤ãŒã‚ã‚Œã°åæ˜ 
        const savedFontSize = localStorage.getItem('fontSize');
        if (savedFontSize) {
            document.body.classList.remove('font-small', 'font-large');
            if (savedFontSize === 'small') document.body.classList.add('font-small');
            if (savedFontSize === 'large') document.body.classList.add('font-large');

            // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚‚ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã«
            fontSizeRadios.forEach(radio => {
                if (radio.value === savedFontSize) radio.checked = true;
            });
        }

        // é¸æŠå¤‰æ›´æ™‚
        fontSizeRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                document.body.classList.remove('font-small', 'font-large');
                if (radio.value === 'small') document.body.classList.add('font-small');
                if (radio.value === 'large') document.body.classList.add('font-large');
                // ä¸­ã®å ´åˆã¯ã‚¯ãƒ©ã‚¹ãªã—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰

                // localStorageã«ä¿å­˜
                localStorage.setItem('fontSize', radio.value);
            });
        });



        // ãƒˆã‚°ãƒ«ãƒªã‚¹ãƒˆ
        const toggleAllBtn = document.getElementById('toggleAll');
        let allOpen = false;

        const items = document.querySelectorAll('.toggle-list');
        items.forEach(item => {
            const header = item.querySelector('.toggle-header'); // classã§å–å¾—
            header.addEventListener('click', () => {
                item.classList.toggle('active');
                const span = header.querySelector('span');
                span.textContent = item.classList.contains('active') ? '-' : '+';
            });
        });


    </script>
</body>

</html>